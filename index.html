<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Un Mensaje Especial</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-primary: #7a1f3d; /* Burdeos oscuro */
      --color-secondary: #4b2e2e; /* Gris√°ceo oscuro */
      --color-background: #fcf9f6; /* Blanco roto */
      --card-bg-color: rgba(255, 255, 255, 0.9); /* M√°s opaco */
      --box-shadow-color: rgba(0, 0, 0, 0.12);
      --font-title: 'Dancing Script', cursive;
      --font-body: 'Montserrat', sans-serif;
    }
    body {
      font-family: var(--font-body);
      margin: 0;
      padding: 0;
      background-color: var(--color-background);
      color: var(--color-secondary);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      overflow: hidden;
      position: relative;
    }
    .container {
      width: 90%;
      max-width: 600px;
      background-color: var(--card-bg-color);
      padding: 2.5em;
      border-radius: 20px;
      box-shadow: 0 15px 40px var(--box-shadow-color);
      position: relative;
      animation: fadeIn 1.5s ease-out;
      min-height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 10;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    h1, h2 {
      font-family: var(--font-title);
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 0.2em;
    }
    h1 { font-size: 3.5em; }
    h2 { font-size: 2.2em; }
    #main-title.heartbeat {
      animation: heartbeat 1.5s infinite;
    }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .content-section {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2.5em;
      box-sizing: border-box;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 1s ease-in-out, transform 1s ease-in-out;
      pointer-events: all;
    }
    .hidden {
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
      display: none;
    }
    .message {
      font-size: 1.2em;
      line-height: 1.6;
      margin: 1em 0 2em;
      font-weight: 300;
      max-width: 80%;
    }
    .small-text {
      font-size: 0.9em;
      margin-top: -1.5em;
      color: var(--color-secondary);
      opacity: 0.8;
      font-style: italic;
    }
    .nav-button {
      font-size: 1em;
      padding: 0.8em 1.5em;
      border: none;
      border-radius: 25px;
      background-color: var(--color-primary);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      font-family: var(--font-body);
    }
    .nav-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      background-color: #a33f5d;
    }
    .unmute-button {
      background: none;
      border: 1px solid var(--color-primary);
      color: var(--color-primary);
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
      font-family: var(--font-body);
      z-index: 20;
    }
    .unmute-button:hover {
      background-color: rgba(122, 31, 61, 0.1);
      transform: scale(1.05);
    }
    .riddle-section { text-align: center; }
    .hint {
      font-style: italic;
      color: var(--color-secondary);
      opacity: 0.7;
      margin-top: 1em;
    }
    #secondary-hint-btn {
        display: none;
        margin-top: 15px;
        background-color: transparent;
        border: 1px solid var(--color-secondary);
        color: var(--color-secondary);
        font-size: 0.9em;
        padding: 8px 15px;
        border-radius: 20px;
        transition: all 0.3s ease;
    }
    #secondary-hint-btn:hover {
        background-color: rgba(75, 46, 46, 0.1);
        transform: scale(1.03);
    }
    input {
      width: 80%;
      padding: 0.8em;
      margin: 1.5em 0 1em 0;
      border-radius: 25px;
      border: 1px solid #ddd;
      text-align: center;
      font-family: var(--font-body);
      transition: border-color 0.3s ease;
    }
    input:focus {
      outline: none;
      border-color: var(--color-primary);
    }
    #result {
      margin-top: 1em;
      font-size: 1.1em;
      font-weight: 500;
      color: var(--color-primary);
    }
    .petal {
      position: absolute;
      width: 15px;
      height: 15px;
      background-color: rgba(255, 182, 193, 0.7);
      border-radius: 50%;
      animation: fall linear infinite;
      z-index: 1;
      pointer-events: none;
    }
    @keyframes fall {
      to { transform: translateY(100vh); }
    }
    .petal-small {
      width: 10px;
      height: 10px;
      background-color: rgba(255, 182, 193, 0.5);
    }
    .petal-big {
      width: 20px;
      height: 20px;
      background-color: rgba(255, 182, 193, 0.9);
    }
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #f06;
      animation: confetti-fall 2s ease-out forwards;
      opacity: 0;
      border-radius: 2px;
      z-index: 100;
    }
    @keyframes confetti-fall {
      0% { transform: translateY(-100px) rotateZ(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotateZ(720deg); opacity: 0; }
    }
    #game-section {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    #game-stats {
        display: flex;
        justify-content: space-around;
        width: 100%;
        margin-bottom: 20px;
        font-size: 1.2em;
        font-weight: 500;
        color: var(--color-primary);
    }
    #game-area {
        position: relative;
        width: 100%;
        height: 300px;
        border: 2px dashed var(--color-secondary);
        border-radius: 15px;
        overflow: hidden;
    }
    .flower {
        position: absolute;
        font-size: 2em;
        cursor: pointer;
        transition: transform 0.2s ease-in-out;
    }
    .flower:hover {
        transform: scale(1.2);
    }
    #game-result {
        margin-top: 20px;
        font-size: 1.2em;
        font-weight: 500;
        min-height: 1.5em;
    }

    /* Estilos para el efecto de m√°quina de escribir */
    .typing-text {
      overflow: hidden; /* Oculta el texto que no se ha "escrito" */
      white-space: pre-wrap; /* Mantiene saltos de l√≠nea y espacios */
      width: 0; /* Ancho inicial 0 */
      animation: typing 0.05s steps(1, end) forwards; /* La animaci√≥n se activa por JS */
    }
    .typing-cursor {
      border-right: 2px solid var(--color-primary); /* Cursor parpadeante */
      animation: blink-caret 0.75s step-end infinite;
    }
    @keyframes typing {
      from { width: 0 }
      to { width: 100% } /* Revela el texto */
    }
    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: var(--color-primary) }
    }

    /* Estilos para las part√≠culas de fondo */
    .particle {
      position: absolute;
      background-color: rgba(255, 200, 220, 0.6); /* Un rosa claro y sutil */
      border-radius: 50%;
      pointer-events: none;
      animation: floatAndFade 15s infinite ease-in-out;
      z-index: 1; /* Detr√°s del contenido principal */
    }
    @keyframes floatAndFade {
      0% { transform: translateY(0) translateX(0) scale(0); opacity: 0; }
      25% { transform: translateY(-20vh) translateX(10vw) scale(1); opacity: 0.7; }
      50% { transform: translateY(-40vh) translateX(-10vw) scale(1); opacity: 0.5; }
      75% { transform: translateY(-60vh) translateX(5vw) scale(0.5); opacity: 0.3; }
      100% { transform: translateY(-80vh) translateX(0) scale(0); opacity: 0; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="content-section" id="initial-card">
    <h1 id="main-title">Para Cindy</h1>
    <p class="message">
      En el silencio de este rinc√≥n digital, he guardado un mensaje que solo t√∫ puedes descifrar. Es un susurro, un gesto de aprecio, una peque√±a pausa para recordarte la admiraci√≥n que siento por ti.
    </p>
    <p class="small-text">
        (No olvides activar el sonido para una experiencia completa)
    </p>
    <p style="font-style: italic; font-size: 1em;">Con la m√°s sincera de las admiraciones,<br><strong>Jaime</strong></p>
    <button class="nav-button" id="start-btn">Si est√°s lista, por favor contin√∫a</button>
  </div>

  <div class="content-section hidden" id="riddle-section">
    <h2>El Acertijo M√°s Dif√≠cil del Mundo</h2>
    <p class="message">
      Es el tiempo de las flores y los nuevos comienzos.<br>
      Es la fecha en que la m√∫sica se viste de un amor sin final.<br>
      Lo celebran los enamorados, y lo recuerda mi alma.
    </p>
    <p class="hint" id="first-hint">
      <em>Pista: Lo que me atrajo de ti, no fue la estaci√≥n, sino el d√≠a.</em>
    </p>
    <button class="nav-button" id="secondary-hint-btn">Necesito otra pista</button>
    <input type="text" id="answer" placeholder="Escribe tu respuesta aqu√≠...">
    <div id="result"></div>
    <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;">
        <button class="nav-button" id="back-btn" onclick="showSection(initialCard, riddleSection);">Volver</button>
        <button class="nav-button" id="verify-btn">Verificar</button>
    </div>
  </div>

  <div class="content-section hidden" id="game-section">
    <h2>Encuentra las Flores</h2>
    <p class="message">
        Antes de continuar, encuentra las 10 flores que aparecer√°n. ¬°S√© r√°pida!
    </p>
    <div id="game-stats">
        <div>Flores: <span id="flowers-found">0</span> / 10</div>
        <div>Tiempo: <span id="timer"></span></div>
    </div>
    <div id="game-area"></div>
    <div id="game-result"></div>
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
        <button class="nav-button" id="start-game-btn">Empezar</button>
        <button class="nav-button hidden" id="restart-game-btn">Reintentar</button>
    </div>
  </div>
  
  <div class="content-section hidden" id="final-section">
    <h2>Un regalo para ti</h2>
    <p class="message"><span id="typed-message"></span><span class="typing-cursor"></span></p>
    <button class="nav-button" onclick="location.reload()">Volver a empezar</button>
  </div>
</div>

<button class="unmute-button" id="unmute-button" style="display:none;">Activar Sonido</button>

<audio id="backgroundAudio" loop>
  <source src="https://www.bensound.com/bensound-music/bensound-love.mp3" type="audio/mpeg">
  Tu navegador no soporta el elemento de audio.
</audio>

<script>
  const backgroundAudio = document.getElementById('backgroundAudio');
  const startBtn = document.getElementById('start-btn');
  const verifyBtn = document.getElementById('verify-btn');
  const answerInput = document.getElementById('answer');
  const resultDiv = document.getElementById('result');
  const initialCard = document.getElementById('initial-card');
  const riddleSection = document.getElementById('riddle-section');
  const gameSection = document.getElementById('game-section');
  const finalSection = document.getElementById('final-section');
  const unmuteButton = document.getElementById('unmute-button');
  const mainTitle = document.getElementById('main-title');
  const secondaryHintBtn = document.getElementById('secondary-hint-btn');
  const firstHint = document.getElementById('first-hint');
  const startGameBtn = document.getElementById('start-game-btn');
  const restartGameBtn = document.getElementById('restart-game-btn');
  const flowersFoundSpan = document.getElementById('flowers-found');
  const timerSpan = document.getElementById('timer');
  const gameArea = document.getElementById('game-area');
  const gameResultDiv = document.getElementById('game-result');
  const typedMessageSpan = document.getElementById('typed-message');

  let audioPlayed = false;
  let hintTimeout;
  
  let flowersToFind = 10;
  let flowersFound = 0;
  let gameTime = 15;
  let gameTimer;
  let isGameActive = false;

  const finalMessageContent = `El cari√±o no se celebra solo una vez, se vive cada d√≠a. Pero hay momentos que merecen un detalle especial para ser atesorados por siempre.
      <br><br>
      El **21 de septiembre** recibir√°s un peque√±o gesto que, espero, ilumine tu d√≠a tanto como t√∫ iluminas el m√≠o.`;


  function playAudio() {
    if (!audioPlayed) {
      backgroundAudio.volume = 0.4;
      const playPromise = backgroundAudio.play();
      if (playPromise !== undefined) {
        playPromise.catch(error => {
          unmuteButton.style.display = 'block';
        });
      }
      audioPlayed = true;
    }
  }

  function showSection(sectionToShow, sectionToHide) {
    sectionToHide.classList.add('hidden');
    sectionToHide.style.pointerEvents = 'none';
    
    setTimeout(() => {
      sectionToHide.style.display = 'none';
      sectionToShow.style.display = 'flex';
      
      setTimeout(() => {
        sectionToShow.classList.remove('hidden');
        sectionToShow.style.pointerEvents = 'all';
        if (sectionToShow === finalSection) {
            typeWriterEffect(typedMessageSpan, finalMessageContent, 50); // Iniciar efecto de m√°quina de escribir
        }
      }, 50); 
    }, 1000);
  }

  function startGame() {
    isGameActive = true;
    flowersFound = 0;
    gameTime = 15;
    flowersFoundSpan.textContent = flowersFound;
    timerSpan.textContent = gameTime;
    gameResultDiv.textContent = "";
    gameArea.innerHTML = "";
    startGameBtn.classList.add('hidden');
    restartGameBtn.classList.add('hidden');

    createFlower();

    gameTimer = setInterval(() => {
        gameTime--;
        timerSpan.textContent = gameTime;
        if (gameTime <= 0) {
            clearInterval(gameTimer);
            isGameActive = false;
            gameResultDiv.textContent = "¬°Se acab√≥ el tiempo! Vuelve a intentarlo.";
            restartGameBtn.classList.remove('hidden');
            gameArea.innerHTML = "";
        }
    }, 1000);
  }

  function createFlower() {
    if (!isGameActive || flowersFound >= flowersToFind) return;

    const flower = document.createElement('span');
    flower.classList.add('flower');
    flower.textContent = 'üåº';
    
    const areaRect = gameArea.getBoundingClientRect();
    const x = Math.random() * (areaRect.width - 50);
    const y = Math.random() * (areaRect.height - 50);
    
    flower.style.left = `${x}px`;
    flower.style.top = `${y}px`;
    
    flower.onclick = () => {
        if (!isGameActive) return;
        flowersFound++;
        flowersFoundSpan.textContent = flowersFound;
        flower.remove();
        if (flowersFound < flowersToFind) {
            createFlower();
        } else {
            clearInterval(gameTimer);
            gameResultDiv.textContent = "¬°Incre√≠ble! ¬°Lo has logrado!";
            verifyBtn.textContent = "Continuar al regalo";
            setTimeout(() => {
                showSection(finalSection, gameSection);
            }, 1500);
        }
    };
    gameArea.appendChild(flower);
  }

  // Funci√≥n para el efecto de m√°quina de escribir
  function typeWriterEffect(element, text, delay) {
      let i = 0;
      element.innerHTML = ''; // Limpiar el contenido existente
      const cursor = document.querySelector('.typing-cursor');
      if (cursor) cursor.style.display = 'inline-block'; // Asegurar que el cursor est√© visible

      function type() {
          if (i < text.length) {
              // Manejar etiquetas HTML como <br> y <strong>
              if (text.substring(i, i + 4) === '<br>') {
                  element.innerHTML += '<br>';
                  i += 4;
              } else if (text.substring(i, i + 8) === '<strong>') {
                  element.innerHTML += '<strong>';
                  i += 8;
                  let strongEnd = text.indexOf('</strong>', i);
                  if (strongEnd !== -1) {
                      let strongText = text.substring(i, strongEnd);
                      element.innerHTML += strongText;
                      i = strongEnd + 9; // Mover el √≠ndice despu√©s de </strong>
                  }
                  element.innerHTML += '</strong>';
              } else {
                  element.innerHTML += text.charAt(i);
                  i++;
              }
              setTimeout(type, delay);
          } else {
              if (cursor) cursor.style.display = 'none'; // Ocultar el cursor al finalizar
          }
      }
      type();
  }


  document.addEventListener('DOMContentLoaded', () => {
    playAudio();
    createPetals();
    createParticles(); // Iniciar part√≠culas de fondo
    mainTitle.classList.add('heartbeat');
  });

  startBtn.addEventListener('click', () => {
    mainTitle.classList.remove('heartbeat');
    showSection(riddleSection, initialCard);
    playAudio();
    unmuteButton.style.display = 'none';
    
    hintTimeout = setTimeout(() => {
        secondaryHintBtn.style.display = 'block';
    }, 15000);
  });

  unmuteButton.addEventListener('click', () => {
    backgroundAudio.play();
    unmuteButton.style.display = 'none';
  });

  verifyBtn.addEventListener('click', () => {
    const answer = answerInput.value.trim().toLowerCase();
    if (answer.includes("21") && answer.includes("septiembre")) {
      resultDiv.innerHTML = "üåπ ¬°Correcto! Has sentido lo que otros solo intentan entender.";
      playConfetti();
      verifyBtn.textContent = "Continuar";
      verifyBtn.onclick = () => showSection(gameSection, riddleSection);
      document.getElementById('back-btn').style.display = 'none';
      clearTimeout(hintTimeout);
      secondaryHintBtn.style.display = 'none';
    } else {
      resultDiv.innerHTML = "No es eso... pero si cierras los ojos y escuchas con el coraz√≥n, quiz√°s lo encuentres.";
    }
  });

  answerInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      verifyBtn.click();
    }
  });

  secondaryHintBtn.addEventListener('click', () => {
      firstHint.innerHTML = '<em>Pista m√°s expl√≠cita: Es un d√≠a en que los girasoles se abren y la amistad se celebra con flores.</em>';
      secondaryHintBtn.style.display = 'none';
  });

  startGameBtn.addEventListener('click', startGame);
  restartGameBtn.addEventListener('click', startGame);

  function createPetals() {
    for (let i = 0; i < 30; i++) {
      const petal = document.createElement('div');
      petal.classList.add('petal');
      petal.style.left = Math.random() * 100 + 'vw';
      petal.style.animationDuration = Math.random() * 10 + 5 + 's';
      petal.style.animationDelay = Math.random() * 5 + 's';
      petal.style.opacity = Math.random() * 0.5 + 0.3;
      document.body.appendChild(petal);
    }
  }

  // Funci√≥n para crear part√≠culas de fondo
  function createParticles() {
    const numParticles = 40; // N√∫mero de part√≠culas
    for (let i = 0; i < numParticles; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      particle.style.width = `${Math.random() * 5 + 5}px`; // Tama√±o entre 5px y 10px
      particle.style.height = particle.style.width;
      particle.style.left = `${Math.random() * 100}vw`;
      particle.style.top = `${Math.random() * 100 + 100}vh`; // Empiezan por debajo de la pantalla
      particle.style.animationDuration = `${Math.random() * 10 + 15}s`; // Duraci√≥n de 15s a 25s
      particle.style.animationDelay = `${Math.random() * 10}s`; // Retraso para que aparezcan escalonadamente
      document.body.appendChild(particle);
    }
  }

  function playConfetti() {
    const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
    const containerRect = document.querySelector('.container').getBoundingClientRect();

    for (let i = 0; i < 50; i++) {
      const confetti = document.createElement('div');
      confetti.classList.add('confetti');
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.left = (containerRect.left + containerRect.width / 2 + (Math.random() - 0.5) * 100) + 'px';
      confetti.style.top = (containerRect.top + containerRect.height / 2 - Math.random() * 50) + 'px';
      confetti.style.animationDelay = (Math.random() * 0.5) + 's';
      confetti.style.animationDuration = (Math.random() * 1.5 + 1.5) + 's';
      confetti.style.transform = `translateY(${Math.random() * -200}px) rotateZ(${Math.random() * 360}deg)`;
      document.body.appendChild(confetti);
      confetti.addEventListener('animationend', () => {
        confetti.remove();
      });
    }
  }
</script>

</body>
</html>